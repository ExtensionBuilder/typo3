/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
import{LitElement as f,html as d,nothing as h}from"lit";import{property as m,customElement as v}from"lit/decorators.js";import p from"@typo3/backend/modal.js";import g from"@typo3/backend/notification.js";import b from"@typo3/backend/severity.js";import k from"@typo3/core/ajax/ajax-request.js";import r from"~labels/extensionmanager.messages";import"@typo3/backend/element/progress-bar-element.js";var u=function(s,o,e,t){var i=arguments.length,n=i<3?o:t===null?t=Object.getOwnPropertyDescriptor(o,e):t,c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(s,o,e,t);else for(var l=s.length-1;l>=0;l--)(c=s[l])&&(n=(i<3?c(n):i>3?c(o,e,n):c(o,e))||n);return i>3&&n&&Object.defineProperty(o,e,n),n};let a=class extends f{constructor(){super(...arguments),this.extensionKey="",this.dependencies={}}createRenderRoot(){return this}render(){const o=r.render("dependencyCheck.unresolvedDependencies.message",{p:e=>d`<p>${e}</p>`,ul:e=>d`<ul>${e}</ul>`,li:e=>d`<li>${e}</li>`,strong:e=>d`<strong>${e}</strong>`});return d`<p>${r.get("dependencyCheck.headline",[this.extensionKey])}</p><ul>${Object.entries(this.dependencies).map(([e,t])=>this.renderDependency(e,t))}</ul>${o?d`<div class="callout callout-warning mt-3"><div class=callout-content><div class=callout-title>${r.get("dependencyCheck.unresolvedDependencies.title")}</div><div class=callout-body>${o}</div></div></div>`:h}<div class="form-check mt-3"><input type=checkbox name=unlockDependencyIgnoreButton id=unlockDependencyIgnoreButton class=form-check-input> <label class=form-check-label for=unlockDependencyIgnoreButton>${r.get("label.resolveDependenciesEnableButton")}</label></div><p class="mt-3 mb-0">${r.get("extensionList.toggleStateConfirmation.reloadMessage")}</p>`}renderDependency(o,e){return o===this.extensionKey?e.map(t=>d`<li>${t.message}</li>`):d`<li><strong>${r.get("dependencyCheck.requiredExtension",[o])}</strong><ul>${e.map(t=>d`<li>${t.message}</li>`)}</ul></li>`}};u([m({type:String,attribute:"extension-key"})],a.prototype,"extensionKey",void 0),u([m({type:Object})],a.prototype,"dependencies",void 0),a=u([v("typo3-extensionmanager-dependency-check")],a);function y(s,o,e,t){const i=document.createElement("typo3-extensionmanager-dependency-check");i.extensionKey=s,i.dependencies=o;const n=p.confirm(r.get("dependencyCheck.modalTitle.activate",[s]),i,b.warning,[{text:r.get("button.cancel"),active:!0,btnClass:"btn-default",trigger:()=>{p.dismiss()}},{text:r.get("dependencyCheck.unresolvedDependencies.proceed"),btnClass:"btn-danger disabled t3js-dependencies",trigger:c=>{c.currentTarget.classList.contains("disabled")||(p.dismiss(),x(s,e,t))}}]);return n.addEventListener("typo3-modal-shown",()=>{const c=n.querySelector(".t3js-dependencies");n.querySelector('input[name="unlockDependencyIgnoreButton"]')?.addEventListener("change",l=>{l.currentTarget.checked?c?.classList.remove("disabled"):c?.classList.add("disabled")})}),n}function x(s,o,e){const t=document.createElement("typo3-backend-progress-bar");document.body.appendChild(t),t.start(),new k(o).post({}).then(async i=>{const n=await i.resolve();if(n.success){e?e():top.location.reload();return}t.done(),n.dependencies&&n.skipDependencyUri?y(s,n.dependencies,n.skipDependencyUri,e):n.error&&g.error(r.get("extensionList.dependenciesResolveInstallError.title"),n.error)},()=>{t.done(),g.error(r.get("extensionList.dependenciesResolveInstallError.title"),r.get("extensionList.dependenciesResolveInstallError.message"))})}export{y as showDependencyModal};
